# todo

> LS_PLC connect 실패시 오류처리필
> _change_mode:exit_wait 발생시 화면초기화

- [x] view 알람, 그래프 함수 작성  
    - [x] 그래프 함수 작성  
    - [x] 알람 함수 작성  


- [x] ctrl 작성  
    - [x] ctrl.load_data
    - [x] ctrl._slider_update
    - [x] ctrl._init_alarm

- [x] model 수정
    - [?] 테이블 읽기 오류 
        - 테이블 전체를 좌르륵 읽고서 타겟 주소 찾기
        - 아냐 이미 그렇게 일하는데 타겟들이 읽은 주소에 매핑되는게 중요

```_change_mode:connect_wait
{'ALARM_APM_X_ERROR': 'off',
 'ALARM_APM_Y_ERROR': 'off',
 'ALARM_APM_Z_ERROR': 'off',
 'ALARM_EMERGENCY_STOP': 'on',
 'ALARM_SEG_EJECT_CONTINUOUS_NG': 'off',
 'SYSTEM_RUN': 0}
{'ALARM_EMERGENCY_STOP': ['on', '2024-10-20 15:44:13']}
False
```


***

- 확인사항

* 비트값, 문자열값
5. 시작신호 안읽힘 <- bit 주소
4. 음수처리
2. 알람처리 확인필
#-----------
1. 그래프인덱스매핑 확인필
3. (load동작에서 타이틀 state전환표시)
6. 프로그램 응답없음
7. 엑셀 다른이름 세이브하고 스왑

#----------------------------------------
모듈화의 모듈화 모듈화의 모듈화

** mx120 시작이 안읽어짐.. 
[주소체계]
: 비트 주소값 뒤에 한 자리 빼고 워드로 읽는게 제일 나은듯함..
워드 주소 체계가 기본이고
바이트 주소 체계는 워드 주소값 *2
비트 주소 체계는 워드 주소값 /10

- 워드로 읽고 비트 처리하기
- 바이트로 읽고 워드 처리하기 (구간읽기)


** 신호 대기시간인건지 프로그램 응답없음이 계속 뜬다 이거 어떻게든 해야함
ㄴ조작불가임
아마 리퀘스트를 멀티스레드로 던져야 할 듯한데 지금도 멀티 아닌가? ? 
이거 확인하기
반환대기에 걸려서 응답없음뜸 틱에서 멀티로 던져야함
ㄴ이거 확인하려면 워커틱에 sleep걸고 응답대기 뜨는지 확인,
	ㄴ워커 멀티로 던진 다음에 응답대기 뜨는지 확인
# ----------------
리퀘스트를 멀티로 던지고 값이 왔을 때 다음 동작을 비동기 실행하는 안
근데 지금까지 이게 아니었다고??
아냐 그게 맞는데 메인스레드(윈도우)의 SELF를 호출하는 경우가 있으면 안된다는거 같다 #https://okky.kr/questions/1459659
........큰일이다
상위 클래스의 워커틱 함수를 갖다 쓰는게 문제인가? 그 함수가 상위 클래스에서 돌아야 해서?
Q쓰레드에서 쓰레드를 만드는건 이중의 작업인가
애초에 그냥 쓰레드 쓰면 문제 해결 되는건 맞고? 알수가 없네 이거 그냥 SLEEP으로 바꿔도 체크 안됨 상위 모듈 갖다 쓰는게 아니라서 
값이 없는 상태에서 읽어도 호출시간 짧아서 확인 안될듯 


1. ....Q쓰레드를 포기한다
2. 문제가 되는 SELF를 찾는다 <- 너무 많음
3. plc 클래스를 워커에 포함시켜서 워커틱을 독립시키기 <- 모델이랑 뷰는 독립 못시킬텐데 
4. view 클래스를 독립시키기 <- 설계 뒤틀기

차라리 4번이 가능성 있어보이는건 착각인가
이런거 설계하는 법은 배운 적이 없는데
이거는 자원 점유의 문제겠죠 그럼 어떻게 해결함
i/o용으로 view 전용 쓰레드 하나랑 모델/컨트롤러 메인쓰레드, 워커 틱 쓰레드(주기 재호출용) 3분할인가
감당 못할거같은데
일단 3분할 구조에서는 워커 틱 쓰레드가 메인쓰레드 사용해도 view는 안막힐것이야..
아마 PLC 사용 이후 결과값만 view에 주면 되니까 점유 오래 안할거고
view를 독립시키고 스레드 계산을 한 다음에 결과를 줘서 view가 갱신. 
이거 스레드간 통신 필요한 건데 그럼 메인 쓰레드 완료시점을 뷰가 어떻게 알아

1. 3분할 구조에서 틱 쓰레드 동작 후 view를 호출해서 화면을 갱신
2. 틱 쓰레드 동작 후 모델 데이터 변경, view는 주기적으로 모델로 화면 갱신
2가 낫지
근데 그럼 틱 동작이 전체 프로그램에 2갠데 괜찮은가 
UPDATE 주기실행 큐쓰레드 말고 방법 있나

멀티 쓰레드 디버깅 << 이거 어려움 관련 확장기능 분명 있겠ㄷ지

이거 일단.. 
# --------------------------------------------------------------------------------------------
1. 비트,음수처리, plc 모듈 독립
2. 동작확인
3. VIEW 독립, 재설계

** 알람처리
1. 알람 주소를 계속 읽는다
2. 변화
- 새 값이 생김
- 기존 값이 사라짐 
로그에 작성
3. 처리에 따라 색상 처리 (미해결-빨강)

# -------------------------------------------------------------------------------------
- [확인필] 그래프 인덱스
인덱스 충돌문제
그래프 인덱스로 동기화해서 사용
*그래프 인덱스에 찍힌 지점만 테이블에서 조회
그래프 인덱스: 테이블 인덱스 딕셔너리 제작 후에 그걸로 테이블 조회

model.graph_idx = [] 순서대로 그래프 인덱스 저장 
view 슬라이더 값에서 model.graph_idx[i] 로 set_text 

# -------------------------------------------------------------------------------------

- 과제
1. 듀얼틱 (1초간격읽기, 5초간격읽기 병행)
2. 상위 클래스 호출 정말 최선인지 확인
3. PLC 쓰기동작 작성
4. 모듈화